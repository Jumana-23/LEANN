{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": [
        // new emdedder
        {
            "name": "New Embedder",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/main.py",
            "console": "integratedTerminal",
            "args": [
                "--search",
                "--use-original",
                "--domain",
                "dpr",
                "--nprobe",
                "5000",
                "--load",
                "flat",
                "--embedder",
                "intfloat/multilingual-e5-small"
            ]
        }
        //python /home/ubuntu/Power-RAG/faiss/demo/simple_build.py
        {
            "name": "main.py",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/main.py",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "--query",
                "1000",
                "--load",
                "bm25"
            ]
        },
        {
            "name": "Simple Build",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "faiss/demo/simple_build.py"
            ],
            "env": {
                "LD_PRELOAD": "/lib/x86_64-linux-gnu/libmkl_core.so:/lib/x86_64-linux-gnu/libmkl_intel_thread.so:/lib/x86_64-linux-gnu/libmkl_intel_lp64.so:/lib/x86_64-linux-gnu/libiomp5.so"
            }
        },
        //# Fix for Intel MKL error
        //export LD_PRELOAD=/lib/x86_64-linux-gnu/libmkl_core.so:/lib/x86_64-linux-gnu/libmkl_intel_thread.so:/lib/x86_64-linux-gnu/libmkl_intel_lp64.so:/lib/x86_64-linux-gnu/libiomp5.so
        //python faiss/demo/build_demo.py
        {
            "name": "Build Demo",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "faiss/demo/build_demo.py"
            ],
            "env": {
                "LD_PRELOAD": "/lib/x86_64-linux-gnu/libmkl_core.so:/lib/x86_64-linux-gnu/libmkl_intel_thread.so:/lib/x86_64-linux-gnu/libmkl_intel_lp64.so:/lib/x86_64-linux-gnu/libiomp5.so"
            }
        },
        {
            "name": "DiskANN Serve",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "demo/main.py",
                "--mode",
                "serve",
                "--engine",
                "sglang",
                "--load-indices",
                "diskann",
                "--domain",
                "rpj_wiki",
                "--lazy-load",
                "--recompute-beighbor-embeddings",
                "--port",
                "8082",
                "--diskann-search-memory-maximum",
                "2",
                "--diskann-graph",
                "240",
                "--search-only"
            ],
            "env": {
                "PYTHONPATH": "${workspaceFolder}/faiss_repo/build/faiss/python:$PYTHONPATH"
            },
            "preLaunchTask": "CMake: build",
        },
        {
            "name": "DiskANN Serve MAC",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "demo/main.py",
                "--mode",
                "serve",
                "--engine",
                "ollama",
                "--load-indices",
                "diskann",
                "--domain",
                "rpj_wiki",
                "--lazy-load",
                "--recompute-beighbor-embeddings"
            ],
            "preLaunchTask": "CMake: build",
            "env": {
                "KMP_DUPLICATE_LIB_OK": "TRUE",
                "OMP_NUM_THREADS": "1",
                "MKL_NUM_THREADS": "1",
                "DYLD_INSERT_LIBRARIES": "/Users/ec2-user/Power-RAG/.venv/lib/python3.10/site-packages/torch/lib/libomp.dylib",
                "KMP_BLOCKTIME": "0"
            }
        },
        {
            "name": "Python Debugger: Current File with Arguments",
            "type": "debugpy",
            "request": "launch",
            "program": "ric/main_ric.py",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "--config-name",
                "${input:configSelection}"
            ],
            "justMyCode": false
        },
        //python ./demo/validate_equivalence.py sglang
        {
            "name": "Validate Equivalence",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/validate_equivalence.py",
            "console": "integratedTerminal",
            "args": [
                "sglang"
            ],
        },
        //python demo/retrieval_demo.py --engine sglang  --skip-embeddings --domain dpr --load-indices flat ivf_flat
        {
            "name": "Retrieval Demo",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/retrieval_demo.py",
            "console": "integratedTerminal",
            "args": [
                "--engine",
                "vllm",
                "--skip-embeddings",
                "--domain",
                "dpr",
                "--load-indices",
                // "flat",
                "ivf_flat"
            ],
        },
        //python demo/retrieval_demo.py --engine sglang  --skip-embeddings --domain dpr  --load-indices  diskann --hnsw-M 64 --hnsw-efConstruction 150 --hnsw-efSearch 128  --hnsw-sq-bits 8 
        {
            "name": "Retrieval Demo DiskANN",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/retrieval_demo.py",
            "console": "integratedTerminal",
            "args": [
                "--engine",
                "sglang",
                "--skip-embeddings",
                "--domain",
                "dpr",
                "--load-indices",
                "diskann",
                "--hnsw-M",
                "64",
                "--hnsw-efConstruction",
                "150",
                "--hnsw-efSearch",
                "128",
                "--hnsw-sq-bits",
                "8"
            ],
        },
        {
            "name": "Find Probe",
            "type": "debugpy",
            "request": "launch",
            "program": "find_probe.py",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
        },
        {
            "name": "Python: Attach",
            "type": "debugpy",
            "request": "attach",
            "processId": "${command:pickProcess}",
            "justMyCode": true
        },
        {
            "name": "Edge RAG",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "edgerag_demo.py"
            ],
            "env": {
                "LD_PRELOAD": "/lib/x86_64-linux-gnu/libiomp5.so /lib/x86_64-linux-gnu/libmkl_core.so /lib/x86_64-linux-gnu/libmkl_intel_lp64.so /lib/x86_64-linux-gnu/libmkl_intel_thread.so",
                "MKL_NUM_THREADS": "1",
                "OMP_NUM_THREADS": "1",
            }
        },
        {
            "name": "Launch Embedding Server",
            "type": "debugpy",
            "request": "launch",
            "program": "demo/embedding_server.py",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "--domain",
                "rpj_wiki",
                "--zmq-port",
                "5556",
            ]
        },
        {
            "name": "HNSW Serve",
            "type": "lldb",
            "request": "launch",
            "program": "${workspaceFolder}/.venv/bin/python",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "demo/main.py",
                "--domain",
                "rpj_wiki",
                "--load",
                "hnsw",
                "--mode",
                "serve",
                "--search",
                "--skip-pa",
                "--recompute",
                "--hnsw-old"
            ],
            "env": {
                "LD_PRELOAD": "/lib/x86_64-linux-gnu/libmkl_core.so:/lib/x86_64-linux-gnu/libmkl_intel_thread.so:/lib/x86_64-linux-gnu/libmkl_intel_lp64.so:/lib/x86_64-linux-gnu/libiomp5.so"
            }
        },
    ],
    "inputs": [
        {
            "id": "configSelection",
            "type": "pickString",
            "description": "Select a configuration",
            "options": [
                "example_config",
                "vllm_gritlm"
            ],
            "default": "example_config"
        }
    ],
}